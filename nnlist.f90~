subroutine nnlist(l,ndim,vol,ncoord,nn)

  implicit none

  integer,intent(in)::l,ndim,vol,ncoord
  integer,intent(out),dimension(ncoord,vol)::nn

  integer::i,lm1
  integer::imod

  if(ncoord == 6 .and. ndim == 2)then
    
     do i=1,vol
        nn(1,I)=i+1
        nn(2,I)=i+LM1
        nn(3,I)=i+L
        nn(4,I)=i-1
        nn(5,I)=i-LM1
        nn(6,I)=i-L
        
        imod=mod(i,L)   
        if(nn(3,I) > vol)  nn(3,i)=nn(3,i)-vol
        if(nn(2,I) > vol)  nn(2,i)=nn(2,i)-vol
        if(nn(5,I) < 0)   nn(5,i)=nn(5,i)+vol
        if(nn(6,I) < 1)   nn(6,i)=nn(6,i)+vol
        
        if(imod == 1)  then
           nn(4,I)=i+L-1
           nn(5,I)=i-1
        end if


        if(imod == 0) then
           nn(2,I)=I+1
           nn(1,I)=I-L+1
        end if
        
        if(i == 1)  nn(5,i)=vol
        if(i == vol) nn(2,i)=1
        
end do 
     
!     lm1=l+1
     
!     do i=1,vol
!        nn(1,i)=i+1
!        nn(2,i)=i+lm1
!        nn(3,i)=i+l
!        nn(4,i)=i-1
!        nn(5,i)=i-lm1
!        nn(6,i)=i-l
        
!        imod=mod(i,l)
        
!        if(nn(3,i).GT.vol)  nn(3,i)=nn(3,i)-vol
!        if(nn(2,i).GT.vol)  nn(2,i)=nn(2,i)-vol
!        if(nn(5,i).LT.0)   nn(5,i)=nn(5,i)+vol
!        if(nn(6,i).LT.1)   nn(6,i)=nn(6,i)+vol
        
!        if(imod.EQ.1)  THEN
!           nn(4,i)=i+l-1
!           nn(5,i)=i-1
!        ENDif
        
!        if(imod.EQ.0) THEN
!           nn(2,i)=i+1
!           nn(1,i)=i-l+1
!        ENDif
        
!        if(i.EQ.1)  nn(5,i)=vol
!        if(i.EQ.vol) nn(2,i)=1
        
!     end do
  end if

end subroutine nnlist
